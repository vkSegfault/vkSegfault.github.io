<!DOCTYPE html><html lang="en" mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="layout-lang" content="en"><meta name="day-prompt" content="d ago"><meta name="hour-prompt" content="hr ago"><meta name="minute-prompt" content="min ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="Hosting Godot 4 server on AWS and Azure" /><meta property="og:locale" content="en" /><meta name="description" content="Godot is slowly1 getting to release of version 4 - probably biggest update to date. Most interesting from our perspective is rewritten networking part. While there is stable Godot 3 relase as well, basically everyone is watching out for new major version. Some game developers will jump on this bandwagon soon (and some of them probably did it already). In this article we will take a look how to setup Godot 4 server in headless mode and host it on 2 popular public cloud provides: AWS and Azure. https://en.wikipedia.org/wiki/Waiting_for_Godot &#8617;" /><meta property="og:description" content="Godot is slowly1 getting to release of version 4 - probably biggest update to date. Most interesting from our perspective is rewritten networking part. While there is stable Godot 3 relase as well, basically everyone is watching out for new major version. Some game developers will jump on this bandwagon soon (and some of them probably did it already). In this article we will take a look how to setup Godot 4 server in headless mode and host it on 2 popular public cloud provides: AWS and Azure. https://en.wikipedia.org/wiki/Waiting_for_Godot &#8617;" /><link rel="canonical" href="https://vksegfault.github.io//posts/godot-server-aws-azure/" /><meta property="og:url" content="https://vksegfault.github.io//posts/godot-server-aws-azure/" /><meta property="og:site_name" content="vkSegfault" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-11-27T00:00:00+01:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Hosting Godot 4 server on AWS and Azure" /><meta name="twitter:site" content="@vksegfault" /><meta name="google-site-verification" content="googlebb3509c3bdf89758" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2023-03-15T09:50:53+01:00","datePublished":"2022-11-27T00:00:00+01:00","description":"Godot is slowly1 getting to release of version 4 - probably biggest update to date. Most interesting from our perspective is rewritten networking part. While there is stable Godot 3 relase as well, basically everyone is watching out for new major version. Some game developers will jump on this bandwagon soon (and some of them probably did it already). In this article we will take a look how to setup Godot 4 server in headless mode and host it on 2 popular public cloud provides: AWS and Azure. https://en.wikipedia.org/wiki/Waiting_for_Godot &#8617;","headline":"Hosting Godot 4 server on AWS and Azure","mainEntityOfPage":{"@type":"WebPage","@id":"https://vksegfault.github.io//posts/godot-server-aws-azure/"},"url":"https://vksegfault.github.io//posts/godot-server-aws-azure/"}</script><title>Hosting Godot 4 server on AWS and Azure | vkSegfault</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="vkSegfault"><meta name="application-name" content="vkSegfault"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang=""><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="https://vksegfault.github.io/assets/peng_hack.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">vkSegfault</a></div><div class="site-subtitle font-italic">Adrian Jurczak</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://twitter.com/vksegfault" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href="https://www.linkedin.com/in/adrian-jurczak/" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['a.jurczak','protonmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Hosting Godot 4 server on AWS and Azure</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Hosting Godot 4 server on AWS and Azure</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Adrian Jurczak </span> on <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Sun, Nov 27, 2022, 12:00 AM +0100" >Nov 27, 2022<i class="unloaded">2022-11-27T00:00:00+01:00</i> </span></div><div> <span> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Wed, Mar 15, 2023, 9:50 AM +0100" >Mar 15<i class="unloaded">2023-03-15T09:50:53+01:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2855 words">15 min read</span></div></div><div class="post-content"><p>Godot is slowly<sup id="fnref:1" role="doc-noteref"><a href="#fn:1" class="footnote" rel="footnote">1</a></sup> getting to release of version 4 - probably biggest update to date. Most interesting from our perspective is rewritten networking part. While there is stable Godot 3 relase as well, basically everyone is watching out for new major version. Some game developers will jump on this bandwagon soon (and some of them probably did it already). <strong>In this article we will take a look how to setup Godot 4 server in headless mode and host it on 2 popular public cloud provides: AWS and Azure.</strong></p><blockquote><p>Note that Godot 4 is currently in beta, there are bugs, some things might change before final release. It’s definitely not production-ready release - keep it in mind. Nonetheless it’s worth giving a shot just for new shiny networking.</p></blockquote><p>If you want take a shallow dive on what’s new with networking in Godot 4 take a look at this series of official blogs:</p><ol><li><a href="https://godotengine.org/article/multiplayer-changes-godot-4-0-report-1">On servers, RSETs and state updates</a><li><a href="https://godotengine.org/article/multiplayer-changes-godot-4-0-report-2">RPC syntax, channels, ordering</a><li><a href="https://godotengine.org/article/multiplayer-changes-godot-4-0-report-3">ENet wrappers, WebRTC</a><li><a href="https://godotengine.org/article/multiplayer-changes-godot-4-0-report-4">Scene Replication</a>.</ol><blockquote><p>Note that we will deploy Godot server on AWS and Azure in fastest possible way, it’s not neccesrily safest nor properly structured.</p></blockquote><h2 id="setup-headless-godot-server">Setup Headless Godot Server</h2><p>With newly baked networking system for Godot 4 setting up networking is much more pleasant and intuitive than it was with Godot 3. First we need to set some variables upfront:</p><div lang="gdscript" class="language-gdscript highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="k">var</span> <span class="n">ADDRESS</span><span class="p">:</span> <span class="kt">String</span>
<span class="k">const</span> <span class="n">PORT</span> <span class="o">=</span> <span class="mi">12077</span>
<span class="k">const</span> <span class="n">MAX_PLAYERS</span> <span class="o">=</span> <span class="mi">8</span>
<span class="k">var</span> <span class="n">server</span><span class="p">:</span> <span class="kt">bool</span>
</pre></table></code></div></div><p>Use any random port above <code class="language-plaintext highlighter-rouge">9999</code>. The <code class="language-plaintext highlighter-rouge">server</code> variable will hold info whether we run it as pure hosting peer. We can use <code class="language-plaintext highlighter-rouge">OS.get_cmdline_args()</code> to get array of all passed args and if - in my case - it’s <code class="language-plaintext highlighter-rouge">--server</code> we set this variable to <code class="language-plaintext highlighter-rouge">true</code>. Note that ideally this should be handled in <code class="language-plaintext highlighter-rouge">_enter_tree()</code> callback (at the beginning) and not <code class="language-plaintext highlighter-rouge">_ready()</code> (at the end of loading process).</p><blockquote><p>We use <code class="language-plaintext highlighter-rouge">server</code> flag to have control over whether it should be <em>server only</em> or <em>server as peer</em>, in latter case we can host game and act as player similiar to any other clients.</p></blockquote><p>So now we are ready to spin up our server:</p><div lang="gdscript" class="language-gdscript highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="k">func</span> <span class="nf">_ready</span><span class="p">():</span>
  <span class="n">spawn_server</span><span class="p">()</span>

<span class="k">func</span> <span class="nf">spawn_server</span><span class="p">():</span>
  <span class="k">var</span> <span class="n">peer</span> <span class="o">=</span> <span class="n">ENetMultiplayerPeer</span><span class="o">.</span><span class="n">new</span><span class="p">()</span>
  <span class="n">peer</span><span class="o">.</span><span class="n">create_server</span><span class="p">(</span><span class="n">PORT</span><span class="p">,</span> <span class="n">MAX_PLAYERS</span><span class="p">)</span>
  <span class="n">multiplayer</span><span class="o">.</span><span class="n">multiplayer_peer</span> <span class="o">=</span> <span class="n">peer</span>
	
  <span class="n">peer</span><span class="o">.</span><span class="n">peer_connected</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">_on_peer_connected</span><span class="p">)</span>
</pre></table></code></div></div><p>We first create ENet peer instance and use it to create server. <code class="language-plaintext highlighter-rouge">multiplayer</code> is global singleton that works over all nodes (we can set multiplayer per scene as well if needed).</p><p>Now that we have working server we want to spawn new character everytime client joins and we achieve this with <code class="language-plaintext highlighter-rouge">_on_peer_connected()</code> function tied to <code class="language-plaintext highlighter-rouge">peer_connected</code> signal.</p><p><code class="language-plaintext highlighter-rouge">peer_connected</code> signal takes 1 arg that we will make use of:</p><div lang="gdscript" class="language-gdscript highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="k">func</span> <span class="nf">_on_peer_connected</span><span class="p">(</span><span class="n">peer_id</span><span class="p">):</span>
  <span class="k">var</span> <span class="n">character</span> <span class="o">=</span> <span class="nb">load</span><span class="p">(</span><span class="s2">"res://path/to/character.tscn"</span><span class="p">)</span>
  <span class="k">var</span> <span class="nb">char</span> <span class="o">=</span> <span class="n">character</span><span class="o">.</span><span class="n">instantiate</span><span class="p">()</span>
  <span class="nb">char</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="nb">char</span><span class="p">)</span>
</pre></table></code></div></div><p>The important part is assigning peer id to <code class="language-plaintext highlighter-rouge">.name</code>of scene (actually global node of this scene) - we will use it later to differentiate between peers.</p><hr /><p>Our code for server is ready, we just need to add 1 more Node - <strong>MultiplayerSpawner</strong>. This is a great new addition which makes setup a lot faster than writing it by hand. So add MultiplayerSpawner as child to your main scene, set <em>Spawn Path</em> to location when Characters are suppose to spawn for every peer and in <em>Auto Spawn List</em> add path to Character scene itself. That’s it! No need to write any code that spawns scenes for every peer.</p><h2 id="setup-godot-client">Setup Godot Client</h2><blockquote><p>Server will run in headless mode but for clients we want to see actual game.</p></blockquote><blockquote><p>Note that Server and Client code may be merged into 1 file for simplicity and just execute proper path based whether it’s server (cmdline arg) or client (paste IP and click Join button).</p></blockquote><p>On client side we need to be able to paste IP address that we want to connect to. We will use <strong>LineEdit</strong> node:</p><div lang="gdscript" class="language-gdscript highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="k">var</span> <span class="n">lineedit_ip</span> <span class="o">=</span> <span class="n">LineEdit</span><span class="o">.</span><span class="n">new</span><span class="p">()</span>
<span class="n">lineedit_ip</span><span class="o">.</span><span class="n">placeholder_text</span> <span class="o">=</span> <span class="s2">"127.0.0.1"</span>
<span class="n">lineedit_ip</span><span class="o">.</span><span class="n">expand_to_text_length</span> <span class="o">=</span> <span class="bp">true</span>
<span class="bp">self</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">lineedit_ip</span><span class="p">)</span>
</pre></table></code></div></div><p>To setup Godot client that will join our server we proceed almost exactly the same as with server setup:</p><div lang="gdscript" class="language-gdscript highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="k">var</span> <span class="n">peer</span> <span class="o">=</span> <span class="n">ENetMultiplayerPeer</span><span class="o">.</span><span class="n">new</span><span class="p">()</span>
<span class="n">ADDRESS</span> <span class="o">=</span> <span class="n">lineedit_ip</span><span class="o">.</span><span class="n">text</span>
<span class="n">peer</span><span class="o">.</span><span class="n">create_client</span><span class="p">(</span><span class="n">ADDRESS</span><span class="p">,</span> <span class="n">PORT</span><span class="p">)</span>
<span class="n">multiplayer</span><span class="o">.</span><span class="n">multiplayer_peer</span> <span class="o">=</span> <span class="n">peer</span>
</pre></table></code></div></div><p>Only difference is <code class="language-plaintext highlighter-rouge">.create_client()</code> instead of <code class="language-plaintext highlighter-rouge">.create_server()</code>. We use the address and port that are set up to this point.</p><hr /><p>Code above sets client peer and now we need to make some preparations for actual Character scene. First let’s add another new great node provided by Godot 4 which is <strong>MultiplayerSynchronizer</strong>. Add it as child of root node of your Character scene and set <em>Root Path</em> to root node as well. Now the important part: click on MultiplayerSynchronizer node and on the bottom - alongside Debugger, Audio, etc tabs - you should see new one: <strong>Replication</strong>. Click it and use <code class="language-plaintext highlighter-rouge">+</code> sign to add properties that should be synced across all connected peers: mainly position and rotation but it’s up to you what are yours particular needs.</p><blockquote><p>Only properties added to MultiplayerSynchronizer will be replicated to other peers!</p></blockquote><p>Last 2 things that we need to do is to set authority and check if current peer is this authority. In <code class="language-plaintext highlighter-rouge">_ready()</code> function add <code class="language-plaintext highlighter-rouge">$MultiplayerSynchronizer.set_multiplayer_authority(str(name).to_int())</code>. Remember that in server paragraph we passed peer id to <code class="language-plaintext highlighter-rouge">name</code> property? This is used here to distinguish peers and only execute physics updates like movement for itself.</p><p>Then in <code class="language-plaintext highlighter-rouge">_process()</code> we just check <code class="language-plaintext highlighter-rouge">if synchronizer.is_multiplayer_authority()</code> and then run all physics code inside.</p><h3 id="export-project-to-executable">Export project to executable</h3><blockquote><p>For simplicity sake we mix both server and client side codebase into one file but in more production-ready environment it would be advised to separate them.</p></blockquote><p>We will export our project into Linux executables so we can later use cloud providers as hosting. Save everything and go to <strong>Project –&gt; Export</strong>. Once there, add template for <code class="language-plaintext highlighter-rouge">Linux/X11</code> and click it. Tick <em>runnable</em>, set export path and leave all other flags with default values.</p><blockquote><p>Note that ready binaries will work on your local network OOTB as well, just run 1 as server and others as clients.</p></blockquote><blockquote><p>Now we will deploy it to 2 popular cloud provides and just for fun we will use different ways to achieve it.</p></blockquote><h2 id="deploy-server-to-aws">Deploy server to AWS</h2><blockquote><p><strong>For AWS we will use boto3</strong></p></blockquote><p>Binaries are just blob files with right permission so we will use S3 bucket to store it. We will use popular <code class="language-plaintext highlighter-rouge">pipenv</code> tool to install <code class="language-plaintext highlighter-rouge">boto3</code> in local isolated environment:</p><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>pipenv <span class="nt">--three</span>
pipenv <span class="nb">install </span>boto3 awscli
</pre></table></code></div></div><p>For simplicity we will use <code class="language-plaintext highlighter-rouge">pipenv run aws configure</code> to setup credentials.</p><h4 id="s3">S3</h4><p>Now we need to create Bucket and upload our server there:</p><div lang="python" class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="n">s3</span> <span class="o">=</span> <span class="n">boto3</span><span class="p">.</span><span class="nf">client</span><span class="p">(</span><span class="s">'s3'</span><span class="p">,</span> <span class="n">region_name</span><span class="o">=</span><span class="s">"eu-central-1"</span><span class="p">)</span>

<span class="n">bucket_name</span> <span class="o">=</span> <span class="s">"godot-server-totally-unique-name-987654321"</span>
<span class="nb">file</span> <span class="o">=</span> <span class="s">"/path/to/GodotServer"</span>

<span class="k">try</span><span class="p">:</span>
  <span class="n">location</span> <span class="o">=</span> <span class="p">{</span><span class="s">'LocationConstraint'</span><span class="p">:</span> <span class="s">"eu-central-1"</span><span class="p">}</span>
  <span class="n">s3</span><span class="p">.</span><span class="nf">create_bucket</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="n">bucket_name</span><span class="p">,</span> <span class="n">CreateBucketConfiguration</span><span class="o">=</span><span class="n">location</span><span class="p">)</span>

  <span class="n">s3</span><span class="p">.</span><span class="nf">upload_file</span><span class="p">(</span><span class="nb">file</span><span class="p">,</span> <span class="n">bucket_name</span><span class="p">,</span> <span class="s">"GodotServer.x86_64"</span><span class="p">)</span>
<span class="k">except</span> <span class="n">ClientError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
  <span class="nf">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</pre></table></code></div></div><h4 id="iam-policy-and-role">IAM Policy and Role</h4><p>Let’s now create IAM role which will allow us access S3 bucket from EC2 instance. We will provide assume policy for Role creation first, so that EC2 will be able to call other services on our behalf:</p><div lang="python" class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="n">assume_policy_dict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">"Version"</span><span class="p">:</span> <span class="s">"2012-10-17"</span><span class="p">,</span>
    <span class="s">"Statement"</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s">"Effect"</span><span class="p">:</span> <span class="s">"Allow"</span><span class="p">,</span>
            <span class="s">"Action"</span><span class="p">:</span> <span class="p">[</span>
                <span class="s">"sts:AssumeRole"</span>
            <span class="p">],</span>
            <span class="s">"Principal"</span><span class="p">:</span> <span class="p">{</span>
                <span class="s">"Service"</span><span class="p">:</span> <span class="p">[</span>
                    <span class="s">"ec2.amazonaws.com"</span>
                <span class="p">]</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></table></code></div></div><p>and new explicit policy for what Principal can actually do:</p><div lang="python" class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="n">policy_dict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">"Version"</span><span class="p">:</span> <span class="s">"2012-10-17"</span><span class="p">,</span>
    <span class="s">"Statement"</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s">"Effect"</span><span class="p">:</span> <span class="s">"Allow"</span><span class="p">,</span>
            <span class="s">"Action"</span><span class="p">:</span> <span class="s">"s3:GetObject"</span><span class="p">,</span>
            <span class="s">"Resource"</span><span class="p">:</span> <span class="s">"arn:aws:s3:::godot-server-totally-unique-name-987654321"</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Let’s now actually create policy, role, instance profile and attach them properly:</p><div lang="python" class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre><td class="rouge-code"><pre><span class="k">try</span><span class="p">:</span>
    <span class="n">policy</span> <span class="o">=</span> <span class="n">iam</span><span class="p">.</span><span class="nf">create_policy</span><span class="p">(</span>
        <span class="n">PolicyName</span> <span class="o">=</span> <span class="s">'godot-policy'</span><span class="p">,</span>
        <span class="n">PolicyDocument</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="n">policy_dict</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">policy_arn</span> <span class="o">=</span> <span class="n">policy</span><span class="p">[</span><span class="s">'Policy'</span><span class="p">][</span><span class="s">'Arn'</span><span class="p">]</span>

    <span class="n">role</span> <span class="o">=</span> <span class="n">iam</span><span class="p">.</span><span class="nf">create_role</span><span class="p">(</span>
        <span class="n">RoleName</span><span class="o">=</span><span class="s">'godot-role'</span><span class="p">,</span>
        <span class="n">AssumeRolePolicyDocument</span><span class="o">=</span><span class="nf">str</span><span class="p">(</span><span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="n">assume_policy_dict</span><span class="p">))</span>
    <span class="p">)</span>

    <span class="n">iam</span><span class="p">.</span><span class="nf">attach_role_policy</span><span class="p">(</span>
        <span class="n">RoleName</span><span class="o">=</span><span class="s">'godot-role'</span><span class="p">,</span>
        <span class="n">PolicyArn</span><span class="o">=</span><span class="n">policy_arn</span>
    <span class="p">)</span>

    <span class="n">instance_profile</span> <span class="o">=</span> <span class="n">iam</span><span class="p">.</span><span class="nf">create_instance_profile</span><span class="p">(</span><span class="n">InstanceProfileName</span><span class="o">=</span><span class="s">'godot-instance-profile'</span><span class="p">)</span>
    <span class="n">instance_profile_arn</span> <span class="o">=</span> <span class="n">instance_profile</span><span class="p">[</span><span class="s">'InstanceProfile'</span><span class="p">][</span><span class="s">'Arn'</span><span class="p">]</span>   <span class="c1"># used later
</span>    <span class="n">iam</span><span class="p">.</span><span class="nf">add_role_to_instance_profile</span><span class="p">(</span><span class="n">InstanceProfileName</span><span class="o">=</span><span class="s">'godot-instance-profile'</span><span class="p">,</span> <span class="n">RoleName</span><span class="o">=</span><span class="s">'godot-role'</span><span class="p">)</span>
<span class="k">except</span> <span class="n">ClientError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
     <span class="nf">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</pre></table></code></div></div><h4 id="ec2">EC2</h4><p>Now we are almost ready to deploy EC2 with all setup above. Last thing to do is to create Security Group that will allow ingress for UDP and TCP on ports 12077-12087 (Godot will use port provided at the beginning of this article and may use increments of if - at least it’s what debugger says). Main reason for this is that <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/default-custom-security-groups.html">default SG group created with EC2 allows all egress traffic but (fortunatelly) ingress from network interfaces that are using same SG only</a>. Finally we provide <em>user data</em> to copy server from S3, install dependencies and actually run server:</p><div lang="python" class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
</pre><td class="rouge-code"><pre><span class="n">ec2</span> <span class="o">=</span> <span class="n">boto3</span><span class="p">.</span><span class="nf">client</span><span class="p">(</span><span class="s">'ec2'</span><span class="p">,</span> <span class="n">region_name</span><span class="o">=</span><span class="s">"eu-central-1"</span><span class="p">)</span>
<span class="n">user_data</span> <span class="o">=</span> <span class="s">"""sudo apt install -y libxcursor-dev libxinerama-dev libxrandr-dev libxi-dev &amp;
            aws s3 cp s3://godot-server-totally-unique-name-987654321/GodotServer . &amp;
            chmod +x GodotServer &amp;
            ./GodotServer --server --headless"""</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">sg</span> <span class="o">=</span> <span class="n">ec2</span><span class="p">.</span><span class="nf">create_security_group</span><span class="p">(</span>
        <span class="n">Description</span><span class="o">=</span><span class="s">'Allow ingress for UDP/TCP on ports 12077-12087'</span><span class="p">,</span>
        <span class="n">GroupName</span><span class="o">=</span><span class="s">'godot-sg'</span>
    <span class="p">)</span>
    <span class="n">sg_id</span> <span class="o">=</span> <span class="n">sg</span><span class="p">[</span><span class="s">'GroupId'</span><span class="p">]</span>

    <span class="n">ec2</span><span class="p">.</span><span class="nf">authorize_security_group_ingress</span><span class="p">(</span>
        <span class="n">GroupId</span><span class="o">=</span><span class="n">sg_id</span><span class="p">,</span>
        <span class="n">IpProtocol</span><span class="o">=</span><span class="s">'udp'</span><span class="p">,</span>
        <span class="n">CidrIp</span><span class="o">=</span><span class="s">'0.0.0.0/0'</span><span class="p">,</span>
        <span class="n">FromPort</span><span class="o">=</span><span class="mi">12077</span><span class="p">,</span>
        <span class="n">ToPort</span><span class="o">=</span><span class="mi">12087</span>
    <span class="p">)</span>

    <span class="n">ec2</span><span class="p">.</span><span class="nf">authorize_security_group_ingress</span><span class="p">(</span>
        <span class="n">GroupId</span><span class="o">=</span><span class="n">sg_id</span><span class="p">,</span>
        <span class="n">IpProtocol</span><span class="o">=</span><span class="s">'udp'</span><span class="p">,</span>
        <span class="n">CidrIp</span><span class="o">=</span><span class="s">'0.0.0.0/0'</span><span class="p">,</span>
        <span class="n">FromPort</span><span class="o">=</span><span class="mi">12077</span><span class="p">,</span>
        <span class="n">ToPort</span><span class="o">=</span><span class="mi">12087</span>
    <span class="p">)</span>

    <span class="n">instances</span> <span class="o">=</span> <span class="n">ec2</span><span class="p">.</span><span class="nf">run_instances</span><span class="p">(</span>
        <span class="n">ImageId</span> <span class="o">=</span> <span class="s">"ami-0caef02b518350c8b"</span><span class="p">,</span> <span class="c1"># Ubu 22.04 LTS
</span>        <span class="n">MinCount</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">MaxCount</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">InstanceType</span><span class="o">=</span><span class="s">"t2.micro"</span><span class="p">,</span>
        <span class="n">IamInstanceProfile</span><span class="o">=</span><span class="p">{</span>
            <span class="s">'Arn'</span><span class="p">:</span> <span class="n">instance_profile_arn</span><span class="p">,</span>
            <span class="s">'Name'</span><span class="p">:</span> <span class="s">'godot-instance-profile'</span>
        <span class="p">},</span>
        <span class="n">SecurityGroupIds</span><span class="o">=</span><span class="p">[</span><span class="s">'sg_id'</span><span class="p">],</span>
        <span class="n">NetworkInterfaces</span><span class="o">=</span><span class="p">[{</span><span class="s">'AssociatePublicIpAddress'</span><span class="p">:</span> <span class="bp">True</span><span class="p">}],</span>
        <span class="n">UserData</span><span class="o">=</span><span class="n">user_data</span>
    <span class="p">)</span>

<span class="k">except</span> <span class="n">ClientError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</pre></table></code></div></div><blockquote><p>Ami provided above is for Ubuntu 22.04 LTS and that’s why OS-specific commands are for <strong>apt</strong>, if you choose to use any RHEL-based distro (like Amazon Linux) please use <code class="language-plaintext highlighter-rouge">sudo yum install libXcursor libXinerama libXrandr libXi</code> instead.</p></blockquote><blockquote><p>We used t2.micro just for this simple example. In production we should use beefy VMs (ideally with HVM support) like bigger T or even better: C family.</p></blockquote><p>What we are actually doing above: spawning 1 instance of Ubuntu 22.04 running on t2.micro and then run Godot server that should be reachable by any clients.</p><h2 id="deploy-server-to-azure">Deploy server to Azure</h2><blockquote><p><strong>For Azure we will use Terraform</strong></p></blockquote><p>First we should tackle case of AZ credentials without checking it in into any repository. For this example we will proceed with <code class="language-plaintext highlighter-rouge">.tfvars</code> file that is also added to <code class="language-plaintext highlighter-rouge">.gitignore</code>.</p><h4 id="access-azure-from-terraform">Access Azure from Terraform:</h4><div lang="terraform" class="language-terraform highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="c1"># vars.tfvars</span>
<span class="nx">subscription_id</span> <span class="err">=</span> <span class="s2">"&lt;YOUR_SUB_ID&gt;"</span>
<span class="nx">tenant_id</span> <span class="err">=</span> <span class="s2">"&lt;YOUR_TENANT_ID&gt;"</span>
<span class="nx">client_id</span> <span class="err">=</span> <span class="s2">"&lt;YOUR_CLIENT_ID&gt;"</span>
<span class="nx">client_secret</span> <span class="err">=</span> <span class="s2">"&lt;YOUR_CLIENT_SECRET&gt;"</span>
</pre></table></code></div></div><div lang="tf" class="language-tf highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre><span class="c1"># vars.tf</span>
<span class="k">variable</span> <span class="s2">"subscription_id"</span> <span class="p">{</span>
  <span class="nx">type</span> <span class="p">=</span> <span class="nx">string</span>
  <span class="nx">sensitive</span> <span class="p">=</span> <span class="kc">true</span>
<span class="p">}</span>

<span class="k">variable</span> <span class="s2">"tenant_id"</span> <span class="p">{</span>
  <span class="nx">type</span> <span class="p">=</span> <span class="nx">string</span>
  <span class="nx">sensitive</span> <span class="p">=</span> <span class="kc">true</span>
<span class="p">}</span>

<span class="k">variable</span> <span class="s2">"client_id"</span> <span class="p">{</span>
  <span class="nx">type</span> <span class="p">=</span> <span class="nx">string</span>
  <span class="nx">sensitive</span> <span class="p">=</span> <span class="kc">true</span>
<span class="p">}</span>

<span class="k">variable</span> <span class="s2">"client_secret"</span> <span class="p">{</span>
  <span class="nx">type</span> <span class="p">=</span> <span class="nx">string</span>
  <span class="nx">sensitive</span> <span class="p">=</span> <span class="kc">true</span>
<span class="p">}</span>
</pre></table></code></div></div><p>We are using <code class="language-plaintext highlighter-rouge">sensitive</code> flag so that Terraform will never print this values nor store them in logs.</p><h4 id="provider">Provider:</h4><div lang="terraform" class="language-terraform highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="k">terraform</span> <span class="p">{</span>
  <span class="nx">required_providers</span> <span class="p">{</span>
    <span class="nx">azurerm</span> <span class="p">=</span> <span class="p">{</span>
      <span class="nx">source</span>  <span class="p">=</span> <span class="s2">"hashicorp/azurerm"</span>
      <span class="nx">version</span> <span class="p">=</span> <span class="s2">"~&gt; 3.0.2"</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="nx">required_version</span> <span class="p">=</span> <span class="s2">"&gt;= 1.1.0"</span>
<span class="p">}</span>

<span class="k">provider</span> <span class="s2">"azurerm"</span> <span class="p">{</span>
    <span class="nx">features</span> <span class="p">{}</span>
    <span class="nx">subscription_id</span> <span class="p">=</span> <span class="kd">var</span><span class="p">.</span><span class="nx">subscription_id</span>
    <span class="nx">tenant_id</span> <span class="p">=</span> <span class="kd">var</span><span class="p">.</span><span class="nx">tenant_id</span>
    <span class="nx">client_id</span> <span class="p">=</span> <span class="kd">var</span><span class="p">.</span><span class="nx">client_id</span>
    <span class="nx">client_secret</span> <span class="p">=</span> <span class="kd">var</span><span class="p">.</span><span class="nx">client_secret</span>
<span class="p">}</span>
</pre></table></code></div></div><blockquote><p>You can embed subscription, tenant, client ids and secret inside <code class="language-plaintext highlighter-rouge">provider</code> block for this example but it’s strongly ill-advised.</p></blockquote><h4 id="resource-group">Resource Group</h4><p>We will use <em>West Europe</em> Region (Netherlands) for our Resource Group:</p><div lang="terraform" class="language-terraform highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="k">resource</span> <span class="s2">"azurerm_resource_group"</span> <span class="s2">"az-vm-rg"</span> <span class="p">{</span>
    <span class="nx">name</span> <span class="p">=</span> <span class="s2">"az-vm-rg"</span>
    <span class="nx">location</span> <span class="p">=</span> <span class="s2">"westeurope"</span>
<span class="p">}</span>
</pre></table></code></div></div><h4 id="blob-storage">Blob Storage</h4><p>Now let’s upload Godot server to Blob Storage:</p><div lang="terraform" class="language-terraform highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="k">resource</span> <span class="s2">"azurerm_storage_account"</span> <span class="s2">"storageaccount"</span> <span class="p">{</span>
    <span class="nx">name</span> <span class="p">=</span> <span class="s2">"uniquegodotstorage9876"</span>
    <span class="nx">resource_group_name</span> <span class="p">=</span> <span class="nx">azurerm_resource_group</span><span class="p">.</span><span class="nx">az</span><span class="err">-</span><span class="nx">vm</span><span class="err">-</span><span class="nx">rg</span><span class="p">.</span><span class="nx">name</span>
    <span class="nx">location</span> <span class="p">=</span> <span class="nx">azurerm_resource_group</span><span class="p">.</span><span class="nx">az</span><span class="err">-</span><span class="nx">vm</span><span class="err">-</span><span class="nx">rg</span><span class="p">.</span><span class="nx">location</span>
    <span class="nx">account_tier</span> <span class="p">=</span> <span class="s2">"Standard"</span>
    <span class="nx">account_replication_type</span> <span class="p">=</span> <span class="s2">"LRS"</span>
<span class="p">}</span>

<span class="k">resource</span> <span class="s2">"azurerm_storage_container"</span> <span class="s2">"container"</span> <span class="p">{</span>
    <span class="nx">name</span> <span class="p">=</span> <span class="s2">"container"</span>
    <span class="nx">storage_account_name</span> <span class="p">=</span> <span class="nx">azurerm_storage_account</span><span class="p">.</span><span class="nx">storageaccount</span><span class="p">.</span><span class="nx">name</span>
    <span class="nx">container_access_type</span> <span class="p">=</span> <span class="s2">"private"</span>
<span class="p">}</span>

<span class="k">resource</span> <span class="s2">"azurerm_storage_blob"</span> <span class="s2">"blob"</span> <span class="p">{</span>
    <span class="nx">name</span> <span class="p">=</span> <span class="s2">"GodotServer"</span>
    <span class="nx">storage_account_name</span> <span class="p">=</span> <span class="nx">azurerm_storage_account</span><span class="p">.</span><span class="nx">storageaccount</span><span class="p">.</span><span class="nx">name</span>
    <span class="nx">storage_container_name</span> <span class="p">=</span> <span class="nx">azurerm_storage_container</span><span class="p">.</span><span class="nx">container</span><span class="p">.</span><span class="nx">name</span>
    <span class="nx">type</span> <span class="p">=</span> <span class="s2">"Block"</span>
    <span class="nx">source</span> <span class="p">=</span> <span class="s2">"path/to/GodotServer"</span>
<span class="p">}</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">container_access_type</code> is by default <code class="language-plaintext highlighter-rouge">private</code> but it’s worth pointing it out.</p><h4 id="network-security-group-rules">Network Security Group Rules</h4><p>Next step is networking setup. It consist of 2 different parts: network security group rules and virtual network itself. Let’s first set firewall rules to allow Godot server speak over UDP and TCP and allow ssh-ing into our machine (used for <code class="language-plaintext highlighter-rouge">remote-exec</code> later on):</p><div lang="terraform" class="language-terraform highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
</pre><td class="rouge-code"><pre><span class="nx">locals</span> <span class="p">{</span>
  <span class="nx">nsg_rules</span> <span class="p">=</span> <span class="p">{</span>

    <span class="nx">tcp_in</span> <span class="p">=</span> <span class="p">{</span>
        <span class="nx">name</span>                       <span class="p">=</span> <span class="s2">"tcp_in"</span>
        <span class="nx">priority</span>                   <span class="p">=</span> <span class="mi">1001</span>
        <span class="nx">direction</span>                  <span class="p">=</span> <span class="s2">"Inbound"</span>
        <span class="nx">access</span>                     <span class="p">=</span> <span class="s2">"Allow"</span>
        <span class="nx">protocol</span>                   <span class="p">=</span> <span class="s2">"Tcp"</span>
        <span class="nx">source_port_range</span>          <span class="p">=</span> <span class="s2">"12077-12087"</span>
        <span class="nx">destination_port_range</span>     <span class="p">=</span> <span class="s2">"12077-12087"</span>
        <span class="nx">source_address_prefix</span>      <span class="p">=</span> <span class="s2">"*"</span>
        <span class="nx">destination_address_prefix</span> <span class="p">=</span> <span class="s2">"*"</span>

    <span class="p">}</span>

    <span class="nx">udp_in</span> <span class="p">=</span> <span class="p">{</span>
        <span class="nx">name</span>                       <span class="p">=</span> <span class="s2">"udp_in"</span>
        <span class="nx">priority</span>                   <span class="p">=</span> <span class="mi">1002</span>
        <span class="nx">direction</span>                  <span class="p">=</span> <span class="s2">"Inbound"</span>
        <span class="nx">access</span>                     <span class="p">=</span> <span class="s2">"Allow"</span>
        <span class="nx">protocol</span>                   <span class="p">=</span> <span class="s2">"Udp"</span>
        <span class="nx">source_port_range</span>          <span class="p">=</span> <span class="s2">"12077-12087"</span>
        <span class="nx">destination_port_range</span>     <span class="p">=</span> <span class="s2">"12077-12087"</span>
        <span class="nx">source_address_prefix</span>      <span class="p">=</span> <span class="s2">"*"</span>
        <span class="nx">destination_address_prefix</span> <span class="p">=</span> <span class="s2">"*"</span>

    <span class="p">}</span>

    <span class="nx">tcp_out</span> <span class="p">=</span> <span class="p">{</span>
        <span class="nx">name</span>                       <span class="p">=</span> <span class="s2">"tcp_out"</span>
        <span class="nx">priority</span>                   <span class="p">=</span> <span class="mi">1003</span>
        <span class="nx">direction</span>                  <span class="p">=</span> <span class="s2">"Outbound"</span>
        <span class="nx">access</span>                     <span class="p">=</span> <span class="s2">"Allow"</span>
        <span class="nx">protocol</span>                   <span class="p">=</span> <span class="s2">"Tcp"</span>
        <span class="nx">source_port_range</span>          <span class="p">=</span> <span class="s2">"12077-12087"</span>
        <span class="nx">destination_port_range</span>     <span class="p">=</span> <span class="s2">"12077-12087"</span>
        <span class="nx">source_address_prefix</span>      <span class="p">=</span> <span class="s2">"*"</span>
        <span class="nx">destination_address_prefix</span> <span class="p">=</span> <span class="s2">"*"</span>
    <span class="p">}</span>

    <span class="nx">udp_out</span> <span class="p">=</span> <span class="p">{</span>
        <span class="nx">name</span>                       <span class="p">=</span> <span class="s2">"udp_out"</span>
        <span class="nx">priority</span>                   <span class="p">=</span> <span class="mi">1004</span>
        <span class="nx">direction</span>                  <span class="p">=</span> <span class="s2">"Outbound"</span>
        <span class="nx">access</span>                     <span class="p">=</span> <span class="s2">"Allow"</span>
        <span class="nx">protocol</span>                   <span class="p">=</span> <span class="s2">"Udp"</span>
        <span class="nx">source_port_range</span>          <span class="p">=</span> <span class="s2">"12077-12087"</span>
        <span class="nx">destination_port_range</span>     <span class="p">=</span> <span class="s2">"12077-12087"</span>
        <span class="nx">source_address_prefix</span>      <span class="p">=</span> <span class="s2">"*"</span>
        <span class="nx">destination_address_prefix</span> <span class="p">=</span> <span class="s2">"*"</span>
    <span class="p">}</span>

    <span class="nx">ssh_in</span> <span class="p">=</span> <span class="p">{</span>
        <span class="nx">name</span>                       <span class="p">=</span> <span class="s2">"ssh_in"</span>
        <span class="nx">priority</span>                   <span class="p">=</span> <span class="mi">100</span>
        <span class="nx">direction</span>                   <span class="p">=</span> <span class="s2">"Inbound"</span>
        <span class="nx">access</span>                      <span class="p">=</span> <span class="s2">"Allow"</span>
        <span class="nx">protocol</span>                    <span class="p">=</span> <span class="s2">"Tcp"</span>
        <span class="nx">source_port_range</span>           <span class="p">=</span> <span class="s2">"*"</span>
        <span class="nx">destination_port_range</span>      <span class="p">=</span> <span class="s2">"22"</span>
        <span class="nx">source_address_prefix</span>       <span class="p">=</span> <span class="s2">"*"</span>
        <span class="nx">destination_address_prefix</span>  <span class="p">=</span> <span class="s2">"*"</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>We can squeeze up some security by limiting <code class="language-plaintext highlighter-rouge">source_address_prefix</code> to some adresses we know.</p><h4 id="virtual-network">Virtual Network</h4><p>Now we can set virtual network that will use rules above:</p><div lang="terraform" class="language-terraform highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
</pre><td class="rouge-code"><pre><span class="k">resource</span> <span class="s2">"azurerm_virtual_network"</span> <span class="s2">"vnet"</span> <span class="p">{</span>
  <span class="nx">name</span>                <span class="p">=</span> <span class="s2">"vnet"</span>
  <span class="nx">address_space</span>       <span class="p">=</span> <span class="p">[</span><span class="s2">"10.0.0.0/16"</span><span class="p">]</span>
  <span class="nx">resource_group_name</span> <span class="p">=</span> <span class="nx">azurerm_resource_group</span><span class="p">.</span><span class="nx">az</span><span class="err">-</span><span class="nx">vm</span><span class="err">-</span><span class="nx">rg</span><span class="p">.</span><span class="nx">name</span>
  <span class="nx">location</span>            <span class="p">=</span> <span class="nx">azurerm_resource_group</span><span class="p">.</span><span class="nx">az</span><span class="err">-</span><span class="nx">vm</span><span class="err">-</span><span class="nx">rg</span><span class="p">.</span><span class="nx">location</span>
<span class="p">}</span>

<span class="k">resource</span> <span class="s2">"azurerm_subnet"</span> <span class="s2">"sub1"</span> <span class="p">{</span>
  <span class="nx">name</span>                 <span class="p">=</span> <span class="s2">"sub1"</span>
  <span class="nx">resource_group_name</span>  <span class="p">=</span> <span class="nx">azurerm_resource_group</span><span class="p">.</span><span class="nx">az</span><span class="err">-</span><span class="nx">vm</span><span class="err">-</span><span class="nx">rg</span><span class="p">.</span><span class="nx">name</span>
  <span class="nx">virtual_network_name</span> <span class="p">=</span> <span class="nx">azurerm_virtual_network</span><span class="p">.</span><span class="nx">vnet</span><span class="p">.</span><span class="nx">name</span>
  <span class="nx">address_prefixes</span>     <span class="p">=</span> <span class="p">[</span><span class="s2">"10.0.2.0/24"</span><span class="p">]</span>
<span class="p">}</span>

<span class="k">resource</span> <span class="s2">"azurerm_public_ip"</span> <span class="s2">"pubip1"</span>   <span class="p">{</span> 
   <span class="nx">name</span>                <span class="p">=</span> <span class="s2">"pubip1"</span> 
   <span class="nx">location</span>            <span class="p">=</span> <span class="nx">azurerm_resource_group</span><span class="p">.</span><span class="nx">az</span><span class="err">-</span><span class="nx">vm</span><span class="err">-</span><span class="nx">rg</span><span class="p">.</span><span class="nx">location</span> 
   <span class="nx">resource_group_name</span> <span class="p">=</span> <span class="nx">azurerm_resource_group</span><span class="p">.</span><span class="nx">az</span><span class="err">-</span><span class="nx">vm</span><span class="err">-</span><span class="nx">rg</span><span class="p">.</span><span class="nx">name</span> 
   <span class="nx">allocation_method</span>   <span class="p">=</span> <span class="s2">"Static"</span>
 <span class="p">}</span> 

<span class="k">resource</span> <span class="s2">"azurerm_network_security_group"</span> <span class="s2">"nsg"</span> <span class="p">{</span>
  <span class="nx">name</span>                <span class="p">=</span> <span class="s2">"nsg"</span>
  <span class="nx">location</span>            <span class="p">=</span> <span class="nx">azurerm_resource_group</span><span class="p">.</span><span class="nx">az</span><span class="err">-</span><span class="nx">vm</span><span class="err">-</span><span class="nx">rg</span><span class="p">.</span><span class="nx">location</span>
  <span class="nx">resource_group_name</span> <span class="p">=</span> <span class="nx">azurerm_resource_group</span><span class="p">.</span><span class="nx">az</span><span class="err">-</span><span class="nx">vm</span><span class="err">-</span><span class="nx">rg</span><span class="p">.</span><span class="nx">name</span>
<span class="p">}</span>

<span class="k">resource</span> <span class="s2">"azurerm_network_security_rule"</span> <span class="s2">"nsg_rules"</span> <span class="p">{</span>
  <span class="nx">for_each</span>                    <span class="p">=</span> <span class="kd">local</span><span class="p">.</span><span class="nx">nsg_rules</span>
  <span class="nx">name</span>                        <span class="p">=</span> <span class="nx">each</span><span class="p">.</span><span class="nx">key</span>
  <span class="nx">priority</span>                    <span class="p">=</span> <span class="nx">each</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">priority</span>
  <span class="nx">direction</span>                   <span class="p">=</span> <span class="nx">each</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">direction</span>
  <span class="nx">access</span>                      <span class="p">=</span> <span class="nx">each</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">access</span>
  <span class="nx">protocol</span>                    <span class="p">=</span> <span class="nx">each</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">protocol</span>
  <span class="nx">source_port_range</span>           <span class="p">=</span> <span class="nx">each</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">source_port_range</span>
  <span class="nx">destination_port_range</span>      <span class="p">=</span> <span class="nx">each</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">destination_port_range</span>
  <span class="nx">source_address_prefix</span>       <span class="p">=</span> <span class="nx">each</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">source_address_prefix</span>
  <span class="nx">destination_address_prefix</span>  <span class="p">=</span> <span class="nx">each</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">destination_address_prefix</span>
  <span class="nx">resource_group_name</span>         <span class="p">=</span> <span class="nx">azurerm_resource_group</span><span class="p">.</span><span class="nx">az</span><span class="err">-</span><span class="nx">vm</span><span class="err">-</span><span class="nx">rg</span><span class="p">.</span><span class="nx">name</span>
  <span class="nx">network_security_group_name</span> <span class="p">=</span> <span class="nx">azurerm_network_security_group</span><span class="p">.</span><span class="nx">nsg</span><span class="p">.</span><span class="nx">name</span>
<span class="p">}</span>

<span class="k">resource</span> <span class="s2">"azurerm_network_interface"</span> <span class="s2">"nic"</span> <span class="p">{</span>
  <span class="nx">name</span>                <span class="p">=</span> <span class="s2">"nic"</span>
  <span class="nx">location</span>            <span class="p">=</span> <span class="nx">azurerm_resource_group</span><span class="p">.</span><span class="nx">az</span><span class="err">-</span><span class="nx">vm</span><span class="err">-</span><span class="nx">rg</span><span class="p">.</span><span class="nx">location</span>
  <span class="nx">resource_group_name</span> <span class="p">=</span> <span class="nx">azurerm_resource_group</span><span class="p">.</span><span class="nx">az</span><span class="err">-</span><span class="nx">vm</span><span class="err">-</span><span class="nx">rg</span><span class="p">.</span><span class="nx">name</span>

  <span class="nx">ip_configuration</span> <span class="p">{</span>
    <span class="nx">name</span>                          <span class="p">=</span> <span class="s2">"ipconfig"</span>
    <span class="nx">subnet_id</span>                     <span class="p">=</span> <span class="nx">azurerm_subnet</span><span class="p">.</span><span class="nx">sub1</span><span class="p">.</span><span class="nx">id</span>
    <span class="nx">private_ip_address_allocation</span> <span class="p">=</span> <span class="s2">"Dynamic"</span>
    <span class="nx">public_ip_address_id</span>          <span class="p">=</span> <span class="nx">azurerm_public_ip</span><span class="p">.</span><span class="nx">pubip1</span><span class="p">.</span><span class="nx">id</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1"># Connect the security group to the network interface</span>
<span class="k">resource</span> <span class="s2">"azurerm_network_interface_security_group_association"</span> <span class="s2">"example"</span> <span class="p">{</span>
  <span class="nx">network_interface_id</span>      <span class="p">=</span> <span class="nx">azurerm_network_interface</span><span class="p">.</span><span class="nx">nic</span><span class="p">.</span><span class="nx">id</span>
  <span class="nx">network_security_group_id</span> <span class="p">=</span> <span class="nx">azurerm_network_security_group</span><span class="p">.</span><span class="nx">nsg</span><span class="p">.</span><span class="nx">id</span>
<span class="p">}</span>
</pre></table></code></div></div><p><strong>In <code class="language-plaintext highlighter-rouge">azurerm_public_ip</code> block we may use <code class="language-plaintext highlighter-rouge">Dynamic</code> allocation, but then we must use <code class="language-plaintext highlighter-rouge">data</code> block as well to fetch it.</strong></p><h4 id="virtual-machine">Virtual Machine</h4><p>The last thing we need to do: spin up 1 VM of Ubuntu 22.04 and remotely exec installation of all dependencies, fetch Godot server binary from Azure Blob and run it.</p><div lang="terraform" class="language-terraform highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
</pre><td class="rouge-code"><pre><span class="k">resource</span> <span class="s2">"azurerm_linux_virtual_machine"</span> <span class="s2">"godot-vm"</span> <span class="p">{</span>
  <span class="nx">name</span>                  <span class="p">=</span> <span class="s2">"godot-vm"</span>
  <span class="nx">resource_group_name</span>   <span class="p">=</span> <span class="nx">azurerm_resource_group</span><span class="p">.</span><span class="nx">az</span><span class="err">-</span><span class="nx">vm</span><span class="err">-</span><span class="nx">rg</span><span class="p">.</span><span class="nx">name</span>
  <span class="nx">location</span>              <span class="p">=</span> <span class="nx">azurerm_resource_group</span><span class="p">.</span><span class="nx">az</span><span class="err">-</span><span class="nx">vm</span><span class="err">-</span><span class="nx">rg</span><span class="p">.</span><span class="nx">location</span>
  <span class="nx">network_interface_ids</span> <span class="p">=</span> <span class="p">[</span><span class="nx">azurerm_network_interface</span><span class="p">.</span><span class="nx">nic</span><span class="p">.</span><span class="nx">id</span><span class="p">]</span>
  <span class="nx">size</span>                  <span class="p">=</span> <span class="s2">"Standard_B1s"</span>
  <span class="nx">admin_username</span>        <span class="p">=</span> <span class="s2">"crazyadmin"</span>
  <span class="nx">admin_password</span>        <span class="p">=</span> <span class="s2">"Dinozaury1"</span>
  
  <span class="c1"># we can use separate resource "azurerm_ssh_public_key" instead</span>
  <span class="nx">admin_ssh_key</span> <span class="p">{</span>   
    <span class="nx">username</span>            <span class="p">=</span> <span class="s2">"crazyadmin"</span>
    <span class="nx">public_key</span>          <span class="p">=</span> <span class="s2">"</span><span class="k">${</span><span class="nx">file</span><span class="p">(</span><span class="s2">"keys/key.pub"</span><span class="p">)</span><span class="k">}</span><span class="s2">"</span>    
  <span class="p">}</span>
  <span class="nx">disable_password_authentication</span> <span class="p">=</span> <span class="kc">false</span>

  <span class="nx">source_image_reference</span> <span class="p">{</span>
    <span class="nx">publisher</span> <span class="p">=</span> <span class="s2">"Canonical"</span>
    <span class="nx">offer</span>     <span class="p">=</span> <span class="s2">"0001-com-ubuntu-server-jammy"</span>
    <span class="nx">sku</span>       <span class="p">=</span> <span class="s2">"22_04-lts-gen2"</span>
    <span class="nx">version</span>   <span class="p">=</span> <span class="s2">"latest"</span>
  <span class="p">}</span>

  <span class="nx">os_disk</span> <span class="p">{</span> 
    <span class="nx">caching</span>              <span class="p">=</span> <span class="s2">"ReadWrite"</span> 
    <span class="nx">storage_account_type</span> <span class="p">=</span> <span class="s2">"Standard_LRS"</span> 
  <span class="p">}</span>


    <span class="nx">connection</span> <span class="p">{</span>
      <span class="nx">type</span>        <span class="p">=</span> <span class="s2">"ssh"</span>
      <span class="nx">host</span>        <span class="p">=</span> <span class="nx">azurerm_public_ip</span><span class="p">.</span><span class="nx">pubip1</span><span class="p">.</span><span class="nx">ip_address</span>
      <span class="nx">user</span>        <span class="p">=</span> <span class="nx">azurerm_linux_virtual_machine</span><span class="p">.</span><span class="nx">godot</span><span class="err">-</span><span class="nx">vm</span><span class="p">.</span><span class="nx">admin_username</span>
      <span class="nx">password</span>    <span class="p">=</span> <span class="nx">azurerm_linux_virtual_machine</span><span class="p">.</span><span class="nx">godot</span><span class="err">-</span><span class="nx">vm</span><span class="p">.</span><span class="nx">admin_password</span>
      <span class="nx">private_key</span> <span class="p">=</span> <span class="s2">"</span><span class="k">${</span><span class="nx">file</span><span class="p">(</span><span class="s2">"keys/key"</span><span class="p">)</span><span class="k">}</span><span class="s2">"</span>
      <span class="nx">timeout</span>     <span class="p">=</span> <span class="s2">"5m"</span>
    <span class="p">}</span>

    <span class="k">provisioner</span> <span class="s2">"remote-exec"</span> <span class="p">{</span>
        <span class="nx">inline</span> <span class="p">=</span> <span class="p">[</span>
            <span class="s2">"sudo apt install -y libxcursor-dev libxinerama-dev libxrandr-dev libxi-dev"</span><span class="p">,</span>
            <span class="s2">"curl -sL https://aka.ms/InstallAzureCLIDeb | sudo bash"</span><span class="p">,</span>
            <span class="s2">"az storage blob download --account-name </span><span class="k">${</span><span class="nx">azurerm_storage_account</span><span class="p">.</span><span class="nx">storageaccount</span><span class="p">.</span><span class="nx">name</span><span class="k">}</span><span class="s2"> -c </span><span class="k">${</span><span class="nx">azurerm_storage_container</span><span class="p">.</span><span class="nx">container</span><span class="p">.</span><span class="nx">name</span><span class="k">}</span><span class="s2"> -n </span><span class="k">${</span><span class="nx">azurerm_storage_blob</span><span class="p">.</span><span class="nx">blob</span><span class="p">.</span><span class="nx">name</span><span class="k">}</span><span class="s2"> --sas-token '</span><span class="k">${data</span><span class="p">.</span><span class="nx">azurerm_storage_account_sas</span><span class="p">.</span><span class="nx">sas_token</span><span class="p">.</span><span class="nx">sas</span><span class="k">}</span><span class="s2">'"</span><span class="p">,</span>
            <span class="s2">"./Godot --server --headless"</span>
        <span class="p">]</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><blockquote><p>Instead of <code class="language-plaintext highlighter-rouge">az</code> CLI utility we can use handy <code class="language-plaintext highlighter-rouge">azcopy</code>: <code class="language-plaintext highlighter-rouge">wget https://aka.ms/downloadazcopy-v10-linux</code>, <code class="language-plaintext highlighter-rouge">tar -xvf downloadazcopy-v10-linux &amp;&amp; cd azcopy_linux_amd64_10.16.2/</code>, <code class="language-plaintext highlighter-rouge">./azcopy copy 'https://uniquegodotstorage9876.blob.core.windows.net/container/Godot?&lt;YOUR_SAS_TOKEN&gt;' '.'</code></p></blockquote><p>Now just call:</p><ol><li><code class="language-plaintext highlighter-rouge">terraform init</code><li><code class="language-plaintext highlighter-rouge">terraform plan -var-file=vars.tfstate -out=out.plan</code><li>and finally <code class="language-plaintext highlighter-rouge">terraform apply out.plan</code></ol><p>As you can see, logic here is more or less similar to what we did with AWS and Boto3 earlier.</p><blockquote><p>Note that you should always use versioning and resource-locking of your Terraform <code class="language-plaintext highlighter-rouge">state</code>!</p></blockquote><h2 id="security-measures">Security measures</h2><p>Note that this post doesn’t cover security aspects that should be normally our top priority. Main purpose of this post is to make simplest possible server-client architecture and deploy it. For production there is a lot more we would need to set before going public.</p><h2 id="footnotes">Footnotes</h2><div class="footnotes" role="doc-endnotes"><ol><li id="fn:1" role="doc-endnote"><p>https://en.wikipedia.org/wiki/Waiting_for_Godot <a href="#fnref:1" class="reversefootnote" role="doc-backlink">&#8617;</a></p></ol></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/cloud/'>cloud</a>, <a href='/categories/godot/'>godot</a>, <a href='/categories/aws/'>aws</a>, <a href='/categories/azure/'>azure</a>, <a href='/categories/terraform/'>terraform</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/godot/" class="post-tag no-text-decoration" >godot</a> <a href="/tags/aws/" class="post-tag no-text-decoration" >aws</a> <a href="/tags/azure/" class="post-tag no-text-decoration" >azure</a> <a href="/tags/python/" class="post-tag no-text-decoration" >python</a> <a href="/tags/boto3/" class="post-tag no-text-decoration" >boto3</a> <a href="/tags/terraform/" class="post-tag no-text-decoration" >terraform</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Hosting Godot 4 server on AWS and Azure - vkSegfault&url=https://vksegfault.github.io//posts/godot-server-aws-azure/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Hosting Godot 4 server on AWS and Azure - vkSegfault&u=https://vksegfault.github.io//posts/godot-server-aws-azure/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Hosting Godot 4 server on AWS and Azure - vkSegfault&url=https://vksegfault.github.io//posts/godot-server-aws-azure/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink('', 'Link copied successfully!')" data-toggle="tooltip" data-placement="top" title="Copy link"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/godot-server-aws-azure/">Hosting Godot 4 server on AWS and Azure</a><li><a href="/posts/terraform-remote-backend/">Terraform remote backend</a><li><a href="/posts/java-simd/">SIMD usage in Java</a><li><a href="/posts/simd-usage-cpp-csharp-rust/">SIMD usage in C++, C# and Rust</a><li><a href="/posts/gentle-intro-gpu-inner-workings/">Gentle introduction to GPUs inner workings</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/aws/">aws</a> <a class="post-tag" href="/tags/cpu/">cpu</a> <a class="post-tag" href="/tags/simd/">simd</a> <a class="post-tag" href="/tags/terraform/">terraform</a> <a class="post-tag" href="/tags/azure/">azure</a> <a class="post-tag" href="/tags/boto3/">boto3</a> <a class="post-tag" href="/tags/cpp/">cpp</a> <a class="post-tag" href="/tags/csharp/">csharp</a> <a class="post-tag" href="/tags/godot/">godot</a> <a class="post-tag" href="/tags/gpu/">gpu</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/terraform-remote-backend/"><div class="card-body"> <span class="timeago small" >Mar 14<i class="unloaded">2023-03-14T00:00:00+01:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Terraform remote backend</h3><div class="text-muted small"><p> It is usually a case that for very small (and sometimes even for medium-sized projects) we store our Terraform state file(s) as a part of our repo - in other words we use local state. While this mi...</p></div></div></a></div><div class="card"> <a href="/posts/java-simd/"><div class="card-body"> <span class="timeago small" >Oct 13, 2021<i class="unloaded">2021-10-13T00:00:00+02:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>SIMD usage in Java</h3><div class="text-muted small"><p> You can consider this post as an extension to previously written SIMD usage in C++, C# and Rust. Example verified on OpenJDK 17 build running on Linux. Seems that CPU intrinsics are no lo...</p></div></div></a></div><div class="card"> <a href="/posts/gentle-intro-gpu-inner-workings/"><div class="card-body"> <span class="timeago small" >Sep 20, 2021<i class="unloaded">2021-09-20T00:00:00+02:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Gentle introduction to GPUs inner workings</h3><div class="text-muted small"><p> This article summarizes some lower level aspect of how GPU executes. Although GPU programming is not that complicated when compared to CPU, it also doesn’t match to what hardware is doing exactly. ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/java-simd/" class="btn btn-outline-primary" prompt="Older"><p>SIMD usage in Java</p></a> <a href="/posts/terraform-remote-backend/" class="btn btn-outline-primary" prompt="Newer"><p>Terraform remote backend</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://www.linkedin.com/in/adrian-jurczak-530aba192/">Adrian Jurczak</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/aws/">aws</a> <a class="post-tag" href="/tags/cpu/">cpu</a> <a class="post-tag" href="/tags/simd/">simd</a> <a class="post-tag" href="/tags/terraform/">terraform</a> <a class="post-tag" href="/tags/azure/">azure</a> <a class="post-tag" href="/tags/boto3/">boto3</a> <a class="post-tag" href="/tags/cpp/">cpp</a> <a class="post-tag" href="/tags/csharp/">csharp</a> <a class="post-tag" href="/tags/godot/">godot</a> <a class="post-tag" href="/tags/gpu/">gpu</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://vksegfault.github.io/{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-RSW0NEDL8V"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-RSW0NEDL8V'); }); </script>
